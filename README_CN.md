# ComfyUI Matrix Nodes

**[🇺🇸 English](README.md)**

一套专为 **提示词驱动 (Prompt-Driven)** 工作流设计的强大节点。支持 10 通道动态加载、智能 ID 解析、文本提取、可视化错误报错，并内置了增强版的 Qwen-VL 编码节点。

---

## ✨ 核心功能

- **十通道全开 (Max 10 Channels)**: 矩阵类节点支持 1-10 路输入输出。**未连接的插槽会自动忽略**，不会报错。
- **智能 ID 解析 (Smart ID)**:
  - 输入 `"X1"` 自动匹配 `X1.jpg`、`X01.png` 或 `X1-描述.webp`。
  - 输入 `"Y2a"` 自动匹配 `Y2a.jpg`、`Y02a_雨天.png`。
- **可视化报错**: 找不到图片时，生成一张**带有巨大红字警告的灰色图片**（例如 "MISSING: A1"），方便快速排查。
- **智能文本提取**: 使用 **Matrix Text Extractor** 从长文本中提取特定的 ID（如 `003`, `X15a`）及其后的描述文本。
- **中文悬停提示**: 鼠标悬停在参数上，即可看到详细的中文功能说明。
- **Qwen-VL 集成**: 内置独立的 Qwen 文本编码节点，纯本地运行，支持 **5 张参考图**。

---

## 📦 包含节点

### 1. Matrix Image Loader (Direct String 10)
**终极加载器**。直接接受字符串输入。
- **输入**: 字符串（文件名、ID 如 "X1"、或关键词）。
- **智能逻辑**: 自动归一化 ID（例如识别 `X1` 等同于 `X01`）。
- **可选输入**: 任意插槽留空均可正常运行。

### 2. Matrix Prompt Splitter (10)
**文本拆分器**。将长文本拆分为 10 个独立的输出字符串。
- **输入**: 长文本 (例如: `Scene1 [A1 | B2 | C3]`)。
- **配置**: 支持自定义中英文括号（`[]`, `【】`）和各种分隔符。

### 3. Matrix Text Extractor (Smart ID)
**文本提取器**。从一段叙述性文本中“嗅探”出 ID。
- **Auto 模式**: 智能抓取 3-5 位的 ID（如 `X15a`, `003`，自动忽略纯单词）。
- **Custom 模式**: 自定义每一位的字符类型（数字/字母）。
- **功能**: 支持提取第 N 个匹配项，并可限制剩余描述文本的字数。

### 4. Matrix Image Loader (Index 10)
**经典版**。通过“前缀+数字滑块”的方式控制。

### 5. Qwen Text Encode (5 Images)
**魔改版 Qwen-VL 编码器**。
- **纯净版**: 移除 API 依赖，纯本地运行。
- **最佳实践**: 支持 **1-5 张参考图**，保证模型最佳注意力分配。

---

## 🛠 安装方法

1. 进入 ComfyUI 的 `custom_nodes` 文件夹。

2. 运行 git 命令克隆本仓库：

    git clone https://github.com/gnrsbassoutlook/ComfyUI-Matrix-Nodes.git

3. 重启 ComfyUI。

---

## 🚀 使用示例

**场景**: 你有一段文本：`"003号镜头：主角(X1a)身穿雨衣走在街上。"`

1. **提取节点 (Text Extractor)**:
   - 输入文本。
   - 模式设为 `Auto`。
   - **输出 ID**: `X1a` (智能识别)。
   - **输出 Remainder**: `身穿雨衣走在街上。` (自动去除标点)。

2. **加载节点 (Loader Node)**:
   - 将 `ID` 连接到 `image1_input`。
   - **结果**: 自动加载 `X01a-主角.jpg`。

3. **Qwen 编码节点**:
   - 将图片和 Remainder 文本连接，用于引导生成。

---

## 📄 License

MIT License