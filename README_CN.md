# ComfyUI Matrix Nodes

**[🇺🇸 English](README.md)**

一套专为 **提示词驱动 (Prompt-Driven)** 工作流设计的强大节点。支持 10 通道动态加载、智能 ID 解析、精准文本切割、可视化错误报错，并内置了增强版的 Qwen-VL 编码节点。

---

## ✨ 核心功能

- **十通道全开**: 矩阵类节点支持 1-10 路输入输出。**未连接的插槽会自动忽略**。
- **智能 ID 解析**: 输入 `"X1"` 自动匹配 `X1.jpg`、`X01.png` 或 `X1-描述.webp`。
- **精准切割**: 新增 **字符切割刀** 节点，支持自定义左右符号截取文本。
- **双语界面**: 节点名称采用 "English | 中文" 显示，更加直观。
- **可视化报错**: 找不到图片时生成灰色警告图，不卡死工作流。
- **Qwen-VL 集成**: 内置独立的 Qwen 文本编码节点，纯本地运行，支持 **5 张参考图**。

---

## 📦 包含节点

### 1. Matrix Image Loader (String 10) | 矩阵-字符加载器
**终极加载器**。直接接受字符串输入。
- **输入**: 字符串（文件名、ID 如 "X1"、或关键词）。
- **智能逻辑**: 自动归一化 ID，智能排序匹配。

### 2. Matrix Prompt Splitter (10) | 矩阵-文本拆分器
**文本拆分器**。将长文本拆分为 10 个独立的输出字符串。
- **配置**: 支持自定义中英文括号（`[]`, `【】`）和各种分隔符。

### 3. Matrix Smart ID Extractor | 矩阵-ID智能提取
**文本提取器**。从叙述性文本中“嗅探”出 ID。
- **功能**: 支持 Auto 智能模式和 Custom 自定义位模式。可分离 ID 与后续描述文本。

### 4. Matrix String Slicer | 矩阵-字符切割刀
**文本手术刀**。截取两个自定义符号之间的文本。
- **场景**: 处理复杂格式字符串，如 `004-[X1|Y2]-远景`。
- **功能**: 自定义左右符号（支持汉字）、选择第 N 个匹配项、是否保留符号本身、三段式输出（左/中/右）。

### 5. Matrix Image Loader (Index 10) | 矩阵-滑块加载器
**经典版**。通过“前缀+数字滑块”的方式控制。

### 6. Qwen Text Encode (5 Images) | Qwen-VL编码器
**魔改版 Qwen-VL 编码器**。
- **纯净版**: 移除 API 依赖，纯本地运行。
- **最佳实践**: 支持 **1-5 张参考图**，保证模型最佳注意力分配。

---

## 🛠 安装方法

1. 进入 ComfyUI 的 custom_nodes 文件夹。

2. 运行 git 命令克隆本仓库：

    git clone https://github.com/gnrsbassoutlook/ComfyUI-Matrix-Nodes.git

3. 重启 ComfyUI。

---

## 🚀 使用示例 (字符切割刀)

**场景**: 你的输入字符串是：`"004-[X1b|X3|Y6|0|0]-展示面桌远景"`

1. **Matrix String Slicer**:
   - **Text Input**: `"004-[X1b|X3|Y6|0|0]-展示面桌远景"`
   - **Left Delimiter**: `-` (横杠)
   - **Right Delimiter**: `]` (右中括号)
   - **Include Delimiters**: `False` (不包含符号)

2. **输出结果**:
   - **Middle**: `[X1b|X3|Y6|0|0` (成功提取核心部分)
   - **Left**: `004-` (保留了左边剩余部分)
   - **Right**: `-展示面桌远景` (保留了右边剩余部分)

---

## 📄 License

MIT License